<html>
<head>
    <meta charset="utf-8">
    <title>Marketing Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='marketing.css') }}">
</head>
<body>
    {% include 'nav_v2.html' %}

    <div class="main-content">

    <h2 class="section-title">Playlist</h2>

    <!-- creer playlist -->
    <section class="card">
        <h3>Créer une nouvelle playlist</h3>
        <form id="create-playlist-form" action="/playlist/create" method="POST" class="form-inline">
            <input
                type="text"
                name="title"
                placeholder="Nom de la playlist"
                required
            >
            <button type="submit" class="btn btn-primary">Créer</button>
        </form>
    </section>

    <!-- select playlist -->
    <section class="card">
        <label for="playlist-select">Choisir une playlist</label>
        <select id="playlist-select">
            <option value="">— Sélectionner —</option>
            {% for p in playlists %}
                <option value="{{ p.id }}">{{ p.title }}</option>
            {% endfor %}
        </select>
    </section>

    <!-- upload mp3 -->
    <section class="card">
        <form action="/upload" method="POST" enctype="multipart/form-data" id="upload-form">
            <input type="hidden" name="playlist_id" id="playlist-id">

            <div class="upload-zone disabled" id="upload-zone">
                <p class="upload-text">Veuillez sélectionner une playlist</p>
                <input
                    type="file"
                    name="audio"
                    id="audio-input"
                    accept=".mp3"
                    required
                    hidden
                >
            </div>

            <button type="submit" id="btn-upload" class="btn btn-secondary" disabled>
                Envoyer
            </button>
        </form>
    </section>

</div>


            <button type="submit" id="btn-upload" disabled>Envoyer</button>
        </form>
    </div>

    <script>
        const playlistSelect = document.getElementById('playlist-select');
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('audio-input');
        const uploadBtn = document.getElementById('btn-upload');
        const hiddenPlaylist = document.getElementById('playlist-id');

        // Activer l'upload quand une playlist est choisie
        playlistSelect.addEventListener('change', () => {
            if (playlistSelect.value) {
                uploadZone.classList.remove('disabled');
                uploadBtn.disabled = false;
                hiddenPlaylist.value = playlistSelect.value;
                uploadZone.querySelector('p').innerText = "Drag & drop ou cliquez pour sélectionner un fichier";

                // clic sur la zone pour ouvrir le file picker
                uploadZone.onclick = () => fileInput.click();
            } else {
                uploadZone.classList.add('disabled');
                uploadBtn.disabled = true;
                hiddenPlaylist.value = "";
                uploadZone.querySelector('p').innerText = "Veuillez sélectionner une playlist";
            }
        });

        // Dragon drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
            }
        });
    </script>

    {% include 'fin_nav.html' %}
</body>
</html>
