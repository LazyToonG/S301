<html>
<head>
    <meta charset="utf-8">
    <title>Marketing Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    {% include 'nav_v2.html' %}

    <div class="main-content">
        <div class="col-gauche">
            <button class="btn-bleu">â–¶ {{t.play}}</button>
            <button class="btn-bleu">ðŸ”€ {{t.shuffle}}</button>
        </div>

        <h3>Playlist</h3>
        <h3>CrÃ©er une nouvelle playlist</h3>
        <form id="create-playlist-form" action="/playlist/create" method="POST">
            <input type="text" name="title" placeholder="Nom de la playlist" required>
            <button type="submit" class="btn-bleu">CrÃ©er</button>
        </form>

        <select id="playlist-select">
            <option value="">-- Choisir une playlist --</option>
            {% for p in playlists %}
                <option value="{{ p.id }}">{{ p.title }}</option>
            {% endfor %}
        </select>

        <form action="/upload" method="POST" enctype="multipart/form-data" id="upload-form">
            <input type="hidden" name="playlist_id" id="playlist-id">

            <div class="upload-zone disabled" id="upload-zone">
                <p>Veuillez sÃ©lectionner une playlist</p>
                <input type="file" name="audio" id="audio-input" accept=".mp3" required style="display:none;">
            </div>

            <button type="submit" id="btn-upload" disabled>Envoyer</button>
        </form>
    </div>

    <script>
        const playlistSelect = document.getElementById('playlist-select');
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('audio-input');
        const uploadBtn = document.getElementById('btn-upload');
        const hiddenPlaylist = document.getElementById('playlist-id');

        // Activer l'upload quand une playlist est choisie
        playlistSelect.addEventListener('change', () => {
            if (playlistSelect.value) {
                uploadZone.classList.remove('disabled');
                uploadBtn.disabled = false;
                hiddenPlaylist.value = playlistSelect.value;
                uploadZone.querySelector('p').innerText = "Drag & drop ou cliquez pour sÃ©lectionner un fichier";

                // clic sur la zone pour ouvrir le file picker
                uploadZone.onclick = () => fileInput.click();
            } else {
                uploadZone.classList.add('disabled');
                uploadBtn.disabled = true;
                hiddenPlaylist.value = "";
                uploadZone.querySelector('p').innerText = "Veuillez sÃ©lectionner une playlist";
            }
        });

        // Drag & drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
            }
        });
    </script>

    {% include 'fin_nav.html' %}
</body>
</html>
